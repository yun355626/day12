<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿ</title>

  <style>
    /* å…¨åŸŸè¨­å®šï¼šå­—å‹èˆ‡ç›’æ¨¡å‹ */
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* èƒŒæ™¯ï¼šä»¥æ‰‹æ©Ÿç‚ºä¸»ï¼Œæ•´å€‹ç•«é¢æŸ”å’Œæ¼¸å±¤ */
    body {
      margin: 0;
      padding: 8px 6px 16px;
      min-height: 100vh;
      background: radial-gradient(circle at top, #ffe9f5 0, #fef5ff 40%, #f6f7ff 100%);
    }

    /* ä¸»å¡ç‰‡å®¹å™¨ï¼šåœ¨æ‰‹æ©Ÿä¸Šå¹¾ä¹æ»¿ç‰ˆï¼Œæ¡Œæ©Ÿå‰‡ç½®ä¸­é¡¯ç¤º */
    .app-container {
      width: 100%;
      max-width: 480px;
      margin: 8px auto 0;
      background: #ffffff;
      border-radius: 20px;
      padding: 22px 20px 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.9);
    }

    /* ç‹—ç‹—åœ“å½¢é ­åƒ */
    .dog-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto 12px;
      border: 4px solid #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    }

    .dog-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* æ¨™é¡Œèˆ‡èªªæ˜æ–‡å­—ï¼ˆç½®ä¸­ï¼‰ */
    .app-title {
      font-size: 21px;
      font-weight: 700;
      text-align: center;
      color: #333;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 12px;
      text-align: center;
      color: #777;
      margin-bottom: 18px;
    }

    /* è¼¸å…¥å€å¡Š */
    .input-group {
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #444;
      margin-bottom: 4px;
    }

    input[type="date"] {
      width: 100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      background: #fafafa;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="date"]:focus {
      border-color: #a96dff;
      box-shadow: 0 0 0 2px rgba(169, 109, 255, 0.25);
      background: #ffffff;
    }

    .hint-text {
      margin-top: 4px;
      font-size: 11px;
      color: #999;
    }

    /* è¨ˆç®—æŒ‰éˆ•ï¼šå¯¬åº¦ 100%ï¼Œåƒæ‰‹æ©Ÿ App æŒ‰éˆ• */
    .btn {
      width: 100%;
      margin-top: 12px;
      padding: 11px 16px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      color: #fff;
      background: linear-gradient(135deg, #7f6dff, #c46dff);
      box-shadow: 0 4px 12px rgba(120, 88, 255, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(120, 88, 255, 0.4);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(120, 88, 255, 0.25);
    }

    /* çµæœå¤–æ¡† */
    .result-wrapper {
      margin-top: 16px;
      padding: 10px 10px 8px;
      border-radius: 14px;
      background: #fff7f3;
      border: 1px solid #ffe0d1;
    }

    .result-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      color: #555;
    }

    .last-time {
      font-size: 11px;
      color: #999;
    }

    /* å…©å€‹çµæœå¡ç‰‡ï¼šç‹—ç‹—å¹´é½¡ / äººé¡å¹´é½¡ */
    .result-cards {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }

    .result-card {
      flex: 1;
      padding: 8px 8px 6px;
      border-radius: 10px;
      background: #ffe4da;
      text-align: center;
    }

    .result-card.secondary {
      background: #ffd9e7;
    }

    .result-label {
      font-size: 11px;
      color: #555;
      margin-bottom: 2px;
    }

    .result-value {
      font-size: 20px;
      font-weight: 700;
      color: #c64646;
    }

    .result-unit {
      font-size: 11px;
      color: #555;
      margin-left: 2px;
    }

    .result-text {
      font-size: 12px;
      color: #503434;
      line-height: 1.5;
    }

    .result-placeholder {
      font-size: 12px;
      color: #777;
      line-height: 1.5;
    }

    .error {
      color: #d64545;
      font-weight: 700;
    }

    /* å…¬å¼æ–‡å­— */
    .formula {
      margin-top: 8px;
      font-size: 11px;
      color: #999;
      text-align: center;
    }

    /* è¼ƒå°è¢å¹•å†å¾®èª¿ï¼šè®“å…ƒç´ ç¨å¾®ç·Šæ¹Šã€çµæœå¡ç‰‡æ”¹ç‚ºç›´å‘ */
    @media (max-width: 360px) {
      .app-container {
        padding: 18px 14px 20px;
        border-radius: 16px;
      }
      .result-cards {
        flex-direction: column;
      }
    }

    /* ä¸­å‹è¢å¹•ä»¥ä¸Šï¼šç¨å¾®åŠ å¤§ä¸€äº›ï¼Œçœ‹èµ·ä¾†æ›´åƒå°å·¥å…·é é¢ */
    @media (min-width: 480px) {
      .app-container {
        margin-top: 24px;
      }
      .app-title {
        font-size: 22px;
      }
      .result-value {
        font-size: 22px;
      }
      .dog-photo {
        width: 130px;
        height: 130px;
      }
    }
  </style>
</head>

<body>
  <div class="app-container">
    <!-- é ‚éƒ¨ï¼šç‹—ç‹—ç…§ç‰‡ï¼ˆå¯ä»¥æ”¹æˆè‡ªå·±çš„åœ–ï¼‰ -->
    <div class="dog-photo">
      <!-- é€™è£¡çš„ src å¯ä»¥æ”¹æˆä½ è‡ªå·±çš„å¦™éº—ç…§ç‰‡ï¼Œ
           æˆ–ä»»ä½• Unsplash åœ–ç‰‡ï¼Œä¾‹å¦‚ï¼š
           https://images.unsplash.com/photo-1537151625747-768eb6cf92b6?auto=format&fit=crop&w=600&q=80 -->
      <img
        src="https://images.unsplash.com/photo-1548199973-03cce0bbc87b?auto=format&fit=crop&w=500&q=60"
        alt="å¦™éº—çš„ç…§ç‰‡">
    </div>

    <!-- æ¨™é¡Œèˆ‡èªªæ˜ -->
    <div class="app-title">ğŸ¶ å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿ</div>
    <div class="subtitle">è¼¸å…¥å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸï¼Œå¹«ä½ æ›ç®—æˆã€Œäººé¡å¹´é½¡ã€ï¼</div>

    <!-- æ—¥æœŸè¼¸å…¥ -->
    <div class="input-group">
      <label for="birthDate">å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸï¼š</label>
      <!-- é è¨­æ—¥æœŸå¯è‡ªè¡Œä¿®æ”¹ -->
      <input type="date" id="birthDate" value="2023-02-28">
      <div class="hint-text">
        é¸å¥½æ—¥æœŸå¾ŒæŒ‰ä¸‹ã€Œé–‹å§‹è¨ˆç®—ã€ã€‚ä¸‹æ¬¡æ‰“é–‹æœƒè‡ªå‹•è¨˜ä½ä¸Šæ¬¡çš„æ—¥æœŸå’Œçµæœã€‚
      </div>
    </div>

    <!-- è¨ˆç®—æŒ‰éˆ• -->
    <button id="calculateBtn" class="btn">é–‹å§‹è¨ˆç®—</button>

    <!-- çµæœå€ -->
    <div id="result" class="result-wrapper">
      <div class="result-title-row">
        <span>ç›®å‰çµæœ</span>
        <span id="lastTime" class="last-time"></span>
      </div>

      <div id="resultContent">
        <div class="result-placeholder">
          é‚„æ²’æœ‰è¨ˆç®—ç´€éŒ„ã€‚<br>
          è«‹å…ˆé¸æ“‡å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸï¼Œå†æŒ‰ã€Œé–‹å§‹è¨ˆç®—ã€ã€‚
        </div>
      </div>
    </div>

    <!-- å…¬å¼èªªæ˜ -->
    <div class="formula">
      å…¬å¼ï¼šäººé¡å¹´é½¡ = 16 Ã— ln(ç‹—ç‹—å¯¦éš›å¹´æ•¸) + 31ï¼ˆln ç‚ºè‡ªç„¶å°æ•¸ï¼‰
    </div>
  </div>

<script>
  const dogName = "å¦™éº—";
  const STORAGE_KEY = "miaoLiDogAgeResult_v3";

  const birthInput = document.getElementById("birthDate");
  const resultContainer = document.getElementById("resultContent");
  const lastTimeSpan = document.getElementById("lastTime");
  const calculateBtn = document.getElementById("calculateBtn");

  /**
   * æŠŠæ™‚é–“å­—ä¸²ï¼ˆISO æˆ– Date ç‰©ä»¶ï¼‰æ ¼å¼åŒ–æˆäººé¡å¥½è®€çš„å°ç£æ™‚é–“
   */
  function formatDateTime(raw) {
    const d = raw instanceof Date ? raw : new Date(raw);
    if (isNaN(d.getTime())) return ""; // è§£æå¤±æ•—å°±ä¸é¡¯ç¤º

    return d.toLocaleString("zh-TW", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit"
    });
  }

  /**
   * æŠŠçµæœæ’ç‰ˆæˆå…©å€‹å¡ç‰‡ + ä¸€æ®µæ•˜è¿°æ–‡å­—
   */
  function renderResult(dogAgeDisplay, humanAgeDisplay, savedAtText) {
    resultContainer.innerHTML = `
      <div class="result-cards">
        <div class="result-card">
          <div class="result-label">ç‹—ç‹—å¹´é½¡</div>
          <div>
            <span class="result-value">${dogAgeDisplay}</span>
            <span class="result-unit">æ­²</span>
          </div>
        </div>
        <div class="result-card secondary">
          <div class="result-label">æ›ç®—æˆäººé¡å¹´é½¡</div>
          <div>
            <span class="result-value">${humanAgeDisplay}</span>
            <span class="result-unit">æ­²</span>
          </div>
        </div>
      </div>
      <div class="result-text">
        ${dogName}ç¾åœ¨å¤§ç´„æ˜¯ <b>${dogAgeDisplay}</b> æ­²çš„ç‹—ç‹—å¹´é½¡ï¼Œ<br>
        å¦‚æœæ›æˆäººé¡ï¼Œå°±æ˜¯å·®ä¸å¤š <b>${humanAgeDisplay}</b> æ­²çš„äººã€‚
      </div>
    `;
    lastTimeSpan.textContent = savedAtText ? `ä¸Šæ¬¡è¨ˆç®—ï¼š${savedAtText}` : "";
  }

  /**
   * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
   */
  function renderError(message) {
    resultContainer.innerHTML = `<div class="result-placeholder error">${message}</div>`;
    lastTimeSpan.textContent = "";
  }

  /**
   * å°‡çµæœå­˜å…¥ localStorageï¼š
   *  - savedAt å­˜ ISO å­—ä¸²ï¼ˆç©©å®šæ ¼å¼ï¼‰
   *  - é¡¯ç¤ºæ™‚å†ç”¨ formatDateTime è½‰æˆå°ç£æ™‚é–“
   */
  function saveToStorage(birthDateStr, dogAgeDisplay, humanAgeDisplay) {
    const now = new Date();
    const iso = now.toISOString();          // å„²å­˜ç”¨
    const savedAtNice = formatDateTime(now); // é¡¯ç¤ºç”¨

    const payload = {
      birthDate: birthDateStr,
      dogAge: dogAgeDisplay,
      humanAge: humanAgeDisplay,
      savedAt: iso
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    return savedAtNice;
  }

  /**
   * å¾ localStorage è¼‰å…¥ä¸Šä¸€æ¬¡çš„çµæœï¼ˆå¦‚æœæœ‰ï¼‰
   */
  function loadFromStorage() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;

    try {
      const data = JSON.parse(raw);

      if (data.birthDate) {
        birthInput.value = data.birthDate;
      }

      if (data.dogAge && data.humanAge) {
        const niceTime = data.savedAt ? formatDateTime(data.savedAt) : "";
        renderResult(data.dogAge, data.humanAge, niceTime);
      }
    } catch (e) {
      console.warn("è§£æ localStorage å¤±æ•—ï¼š", e);
    }
  }

  /**
   * é»æ“Šã€Œé–‹å§‹è¨ˆç®—ã€ï¼š
   * 1. é©—è­‰æ—¥æœŸ
   * 2. è¨ˆç®—ç‹—ç‹—å¯¦éš›å¹´æ•¸
   * 3. å¥—å…¬å¼ç®—äººé¡å¹´é½¡
   * 4. é¡¯ç¤ºçµæœ + å­˜ localStorage
   */
  calculateBtn.addEventListener("click", () => {
    const birthValue = birthInput.value;

    if (!birthValue) {
      renderError("è«‹å…ˆé¸æ“‡å¦™éº—çš„å‡ºç”Ÿæ—¥æœŸå–”ï¼");
      return;
    }

    const birthDate = new Date(birthValue);
    const today = new Date();

    if (birthDate > today) {
      renderError("å‡ºç”Ÿæ—¥æœŸä¸èƒ½æ˜¯æœªä¾†çš„æ—¥æœŸï½");
      return;
    }

    const diffMs = today - birthDate;
    const years = diffMs / (1000 * 60 * 60 * 24 * 365.25);

    if (years <= 0) {
      renderError(`${dogName}ç¾åœ¨é‚„æ˜¯å‰›å‡ºç”Ÿçš„å°å¯¶å¯¶ï¼Œå¹´é½¡å¤ªå°æš«æ™‚ç„¡æ³•æ›ç®—æˆäººé¡å¹´é½¡å–”ï¼`);
      return;
    }

    const dogAgeYears = years;
    const humanAgeYears = 16 * Math.log(dogAgeYears) + 31; // ln

    const dogAgeDisplay = dogAgeYears.toFixed(1);
    const humanAgeDisplay = humanAgeYears.toFixed(1);

    const savedAt = saveToStorage(birthValue, dogAgeDisplay, humanAgeDisplay);
    renderResult(dogAgeDisplay, humanAgeDisplay, savedAt);
  });

  // è¼‰å…¥é é¢æ™‚ï¼ŒæŠŠä¸Šä¸€æ¬¡çµæœå¸¶å‡ºä¾†
  document.addEventListener("DOMContentLoaded", loadFromStorage);
</script>

</body>
</html>
